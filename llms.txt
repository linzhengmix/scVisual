## Installation

``` r
install.packages('devtools')

devtools::install_github("jokergoo/ComplexHeatmap")

devtools::install_github('linzhengmix/scVisual')

# if not install ggunchull
devtools::install_github("sajuukLyu/ggunchull", type = "source")

library(scVisual)
```

## Example

``` r
library(scVisual)

# load test data
test <- system.file("extdata", "seuratTest.RDS", package = "scVisual")
tmp <- readRDS(test)


# umap
clusterCornerAxes(object = tmp,reduction = 'umap',
                  no_split = T)

# facet by metadata column "orig.ident"
clusterCornerAxes(object = tmp,
                  reduction = 'umap',
                  no_split = F,
                  group_facet = 'orig.ident',
                  aspect_ratio = 1,
                  rel_length = 0.5)

# retain only one axes
clusterCornerAxes(object = tmp,
                  reduction = 'umap',
                  no_split = F,
                  group_facet = 'orig.ident',
                  aspect_ratio = 1,
                  rel_length = 0.5,
                  axes = 'one')


# 在调用函数前确保数据干净
prepare_clean_data <- function(seurat_obj, group_column = "orig.ident") {
  # 1. 获取原始数据
  col_data <- seurat_obj@meta.data[[group_column]]

  # 2. 检查并清理问题值
  # 替换NA值
  if (any(is.na(col_data))) {
    cat("发现NA值，将替换为'Unknown'\n")
    col_data[is.na(col_data)] <- "Unknown"
  }

  # 替换空字符串
  if (any(col_data == "")) {
    cat("发现空字符串，将替换为'Unknown'\n")
    col_data[col_data == ""] <- "Unknown"
  }

  # 3. 获取有效的唯一值
  unique_vals <- unique(col_data)
  unique_vals <- unique_vals[unique_vals != "" & !is.na(unique_vals)]

  if (length(unique_vals) == 0) {
    stop("没有有效的分组值")
  }

  # 4. 创建因子
  seurat_obj@meta.data[[group_column]] <- factor(col_data, levels = unique_vals)

  cat("清理完成，因子水平:", paste(levels(seurat_obj@meta.data[[group_column]]), collapse = ", "), "\n")

  return(seurat_obj)
}

# 使用清理后的数据
tmp_clean <- prepare_clean_data(tmp, "orig.ident")

# 现在调用函数
clusterCornerAxes(object = tmp_clean,
                  reduction = 'umap',
                  no_split = F,
                  group_facet = 'orig.ident',
                  aspect_ratio = 1,
                  rel_length = 0.5,
                  axes = 'one')



# 自定义输出顺序
tmp$orig.ident <- factor(tmp$orig.ident,
                         levels = c("ST2", "ST1", "ST3", "ST4"))

clusterCornerAxes(object = tmp,
                  reduction = 'umap',
                  no_split = F,
                  group_facet = 'orig.ident',
                  aspect_ratio = 1,
                  rel_length = 0.5,
                  axes = 'one')
```

# Package index

## All functions

- [`averageHeatmap()`](https://github.com/linzhengmix/scVisual/reference/averageHeatmap.md)
  : Plot averaged gene expression cross cluster cells
- [`cellRatioPlot`](https://github.com/linzhengmix/scVisual/reference/cellRatioPlot.md)
  : using cellRatioPlot to visualize cell percent ratio across clusters
- [`clusterCornerAxes`](https://github.com/linzhengmix/scVisual/reference/clusterCornerAxes.md)
  : Add corner axes on seurat UMAP/tSNE cluster figures
- [`drawLegend`](https://github.com/linzhengmix/scVisual/reference/drawLegend.md)
  : using drawLegend to add cluster id in legend
- [`featureCornerAxes`](https://github.com/linzhengmix/scVisual/reference/featureCornerAxes.md)
  : Add corner axes on seurat UMAP/tSNE gene FeaturePlot function
  figures
- [`featurePlot`](https://github.com/linzhengmix/scVisual/reference/featurePlot.md)
  : This function creates a scatter plot for multiple genes or features
  from a Seurat object.
- [`get_first_level()`](https://github.com/linzhengmix/scVisual/reference/get_first_level.md)
  : Get first level maintaining factor order
- [`grid.colorkey()`](https://github.com/linzhengmix/scVisual/reference/grid.colorkey.md)
  : Custom color key for grid plots
- [`grid.xaxis2()`](https://github.com/linzhengmix/scVisual/reference/grid.xaxis2.md)
  : Custom x-axis for grid plots
- [`grid.yaxis2()`](https://github.com/linzhengmix/scVisual/reference/grid.yaxis2.md)
  : Custom y-axis for grid plots
- [`jjDotPlot`](https://github.com/linzhengmix/scVisual/reference/jjDotPlot.md)
  : Dot Plot for Gene Expression Visualization
- [`jjVolcano`](https://github.com/linzhengmix/scVisual/reference/jjVolcano.md)
  : using jjVolcano to visualize marker genes
- [`marker_volcano`](https://github.com/linzhengmix/scVisual/reference/marker_volcano.md)
  [`markerVolcano`](https://github.com/linzhengmix/scVisual/reference/marker_volcano.md)
  : Marker genes volcano plot
- [`pbmc.markers`](https://github.com/linzhengmix/scVisual/reference/pbmc.markers.md)
  : This is a test data for this package test data description
- [`scatter_cell_plot()`](https://github.com/linzhengmix/scVisual/reference/scatter_cell_plot.md)
  : Create a scatter cell plot using the grid package
- [`top3pbmc.markers`](https://github.com/linzhengmix/scVisual/reference/top3pbmc.markers.md)
  : This is a test data for this package test data description
- [`tracks_plot()`](https://github.com/linzhengmix/scVisual/reference/tracks_plot.md)
  : Generate a track or heatmap plot based on the provided data
- [`useMyCol()`](https://github.com/linzhengmix/scVisual/reference/useMyCol.md)
  : Custom color palette function
- [`validate_factor_support()`](https://github.com/linzhengmix/scVisual/reference/validate_factor_support.md)
  : Validate and warn about factor status

# Articles

### All vignettes

- [averageHeatmap: Average Expression
  Heatmap](https://github.com/linzhengmix/scVisual/articles/averageHeatmap.md):
- [cellRatioPlot: Cell Ratio
  Plot](https://github.com/linzhengmix/scVisual/articles/cellRatioPlot.md):
- [clusterCornerAxes: Cluster Corner Axes
  Plot](https://github.com/linzhengmix/scVisual/articles/clusterCornerAxes.md):
- [drawLegend: Custom Legend
  Drawing](https://github.com/linzhengmix/scVisual/articles/drawLegend.md):
- [featureCornerAxes: Feature Corner Axes
  Plot](https://github.com/linzhengmix/scVisual/articles/featureCornerAxes.md):
- [featurePlot: Feature Expression
  Plot](https://github.com/linzhengmix/scVisual/articles/featurePlot.md):
- [jjDotPlot: Dot Plot for Gene
  Expression](https://github.com/linzhengmix/scVisual/articles/jjDotPlot.md):
- [jjVolcano: Enhanced Volcano
  Plot](https://github.com/linzhengmix/scVisual/articles/jjVolcano.md):
- [markerVolcano: Volcano Plot for Marker
  Genes](https://github.com/linzhengmix/scVisual/articles/markerVolcano.md):
- [scatterCellPlot: Scatter Plot for
  Cells](https://github.com/linzhengmix/scVisual/articles/scatterCellPlot.md):
- [scVisual: Single-cell Visualization
  Tools](https://github.com/linzhengmix/scVisual/articles/scVisual.md):
- [tracksPlot: Tracks
  Plot](https://github.com/linzhengmix/scVisual/articles/tracksPlot.md):
